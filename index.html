<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>אתגר היומיום</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 50px; background-color: #f0f8ff; }
    h1,h2 { color: #333; }
    #challenge { margin: 20px 0; font-size: 24px; font-weight: bold; }
    input { padding: 10px; margin: 5px; font-size: 16px; }
    button { padding: 10px 20px; font-size: 18px; cursor: pointer; margin: 5px; }
  </style>
</head>
<body>
  <h1>אתגר היומיום</h1>

  <div id="auth-container">
    <h2>התחבר / הירשם</h2>

    <!-- Google -->
    <button onclick="signInWithGoogle()">התחבר עם Google</button>
    <hr>

    <!-- Email/Password -->
    <input type="email" id="email" placeholder="אימייל">
    <input type="password" id="password" placeholder="סיסמה">
    <br>
    <button onclick="signUp()">הרשמה</button>
    <button onclick="signIn()">התחברות</button>
    <hr>

    <!-- Phone/SMS -->
    <input type="text" id="phoneNumber" placeholder="מספר טלפון עם קידומת +972">
    <button onclick="sendOTP()">שלח קוד</button>
    <br>
    <input type="text" id="otp" placeholder="הכנס קוד שקיבלת">
    <button onclick="verifyOTP()">אמת קוד</button>
    <div id="recaptcha-container"></div>
  </div>

  <div id="welcome" style="display:none;">
    <h2>ברוך הבא!</h2>
    <div id="challenge"></div>
    <button onclick="signOut()">התנתק</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>

  <script>
    // ======================
    // Firebase Config
    // ======================
    const firebaseConfig = {
      apiKey: "AIzaSyC3mC1SpEqCcJ_3OV51P5dQafxhaBiNXMQ",
      authDomain: "challenge-app-1bcf5.firebaseapp.com",
      projectId: "challenge-app-1bcf5",
      storageBucket: "challenge-app-1bcf5.firebasestorage.app",
      messagingSenderId: "983360967243",
      appId: "1:983360967243:web:4d5335e561ebaa6c50b3ce",
      measurementId: "G-BLLYZLVGG4"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // ======================
    // Challenges
    // ======================
    const challenges = [
      "צייר משהו בתוך 2 דקות בלבד!",
      "צלם זווית מוזרה של החדר שלך",
      "מצא מילה חדשה בשפה אחרת והשתמש בה היום",
      "המציא בדיחה קצרה ושלח לחבר",
      "עשה חמש שקיעות של חישוקים אם יש לך",
      "כתוב סיפור קצר בן 5 משפטים",
      "צייר פרצוף מצחיק על דף ונחמד לשתף"
    ];

    function getTodaysChallenge() {
      const today = new Date();
      const dayOfYear = Math.floor(
        (today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24
      );
      const index = dayOfYear % challenges.length;
      return challenges[index];
    }

    // ======================
    // Google Sign-In
    // ======================
    function signInWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then(() => showWelcome())
        .catch(error => alert(error.message));
    }

    // ======================
    // Email/Password
    // ======================
    function signUp() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => showWelcome())
        .catch(error => alert(error.message));
    }

    function signIn() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(() => showWelcome())
        .catch(error => alert(error.message));
    }

    // ======================
    // Phone/SMS
    // ======================
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
      'size': 'invisible',
      'callback': function(response) {}
    });

    function sendOTP() {
      const phoneNumber = document.getElementById('phoneNumber').value;
      const appVerifier = window.recaptchaVerifier;
      auth.signInWithPhoneNumber(phoneNumber, appVerifier)
        .then(confirmationResult => {
          window.confirmationResult = confirmationResult;
          alert("הקוד נשלח למספר שלך!");
        })
        .catch(error => alert(error.message));
    }

    function verifyOTP() {
      const code = document.getElementById('otp').value;
      window.confirmationResult.confirm(code)
        .then(() => {
          alert("התחברת בהצלחה!");
          showWelcome();
        })
        .catch(error => alert(error.message));
    }

    // ======================
    // Common
    // ======================
    function signOut() {
      auth.signOut().then(() => location.reload());
    }

    function showWelcome() {
      document.getElementById('auth-container').style.display = 'none';
      document.getElementById('welcome').style.display = 'block';
      document.getElementById('challenge').textContent = getTodaysChallenge();
    }

    auth.onAuthStateChanged(user => {
      if (user) showWelcome();
    });
  </script>
</body>
</html>
